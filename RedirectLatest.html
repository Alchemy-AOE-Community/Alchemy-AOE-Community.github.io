<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirecting to latest PDF…</title>
  <script>
  (async ()=>{
    // 1) grab the ?file=… parameter
    const prefix = new URLSearchParams(location.search).get('file');
    if (!prefix) {
      document.body.textContent = 'Error: no “?file=” parameter provided.';
      return;
    }

    // 2) repo info for your PDFs
    const owner  = 'Alchemy-AOE-Community';
    const repo   = 'CHEM-Published-Specifications';
    const branch = 'download-to-click-links';
    const path   = '';  // sub-folder within the repo, if any

    // 3) list the directory via GitHub API
    const api = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;
    let dir;
    try {
      const r = await fetch(api);
      if (!r.ok) throw new Error(r.status + ' ' + r.statusText);
      dir = await r.json();
    } catch (e) {
      document.body.textContent = 'Error fetching file list: ' + e;
      return;
    }

    // 4) filter by prefix, sort, pick the latest
    const matches = dir
      .map(item => item.name)
      .filter(name => name.startsWith(prefix))
      .sort();
    if (!matches.length) {
      document.body.textContent = `No files starting with “${prefix}” found.`;
      return;
    }
    const latest = matches.pop();

    // 5) build the raw.githubusercontent URL & redirect
    //    raw URL format: https://raw.githubusercontent.com/OWNER/REPO/BRANCH/PATH/FILENAME
    const target = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${path}${latest}`;
    window.location.replace(target);
  })();
  </script>
</head>
<body>
  <p>Redirecting… if you’re not forwarded, <a id="fallback" href="#">click here</a>.</p>
  <script>
    // When replace() happens, the new URL doesn’t update location.hash.
    // So we capture it manually:
    const originalReplace = window.location.replace;
    window.location.replace = function(u) {
      document.getElementById('fallback').href = u;
      originalReplace.call(window.location, u);
    };
  </script>
</body>
</html>