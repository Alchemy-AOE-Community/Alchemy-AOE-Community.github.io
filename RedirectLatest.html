<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <!--
    RedirectLatest.html
    -------------------
    Purpose:
      Redirects to the “latest” PDF in a subfolder whose name matches the
      ?file=PREFIX query‐parameter.  Fits inside the
      Alchemy-AOE-Community.github.io Pages site.

    Usage (for Writer/PDF links):
      https://Alchemy-AOE-Community.github.io/RedirectLatest.html?file=PREFIX

    Example:
      To point at the latest CHEM-HDBK-L2 file, use
         https://Alchemy-AOE-Community.github.io/RedirectLatest.html?file=CHEM-HDBK-L2

    Notes:
      • PREFIX must exactly match the subfolder name under
        CHEM-Published-Specifications (branch download-to-click-links).
      • The script will fetch GitHub’s API, sort names, and auto-redirect
        clients to the raw.githubusercontent.com URL of the newest file.
  -->

  <title>Redirecting to latest PDF…</title>
<script>
(async () => {
  const prefix = new URLSearchParams(location.search).get('file');
  if (!prefix) {
    document.body.textContent = 'Error: no “?file=” parameter provided.';
    return;
  }

  const owner = 'Alchemy-AOE-Community';
  const repo = 'CHEM-Published-Specifications';
  const branch = 'download-to-click-links';
  const folder = encodeURIComponent(prefix);

  const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${folder}?ref=${branch}`;
  let dir;
  try {
    const res = await fetch(apiUrl);
    if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
    dir = await res.json();
  } catch (e) {
    document.body.textContent = 'Error fetching folder “' + prefix + '”: ' + e;
    return;
  }

  const matches = dir
    .map(item => item.name)
    .filter(name => name.startsWith(prefix) && name.toLowerCase().endsWith('.pdf'))
    .sort();
  if (!matches.length) {
    document.body.textContent = `No PDF files beginning with “${prefix}” found.`;
    return;
  }
  const latest = matches.pop();
  const target = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${folder}/${latest}`;
  window.location.replace(target);
})();
</script>

</body>
</html>